# Java Transaction Simulator

<a href="https://opensource.org/licenses/BSD-3-Clause" rel="nofollow"><img src="https://camo.githubusercontent.com/8ccf186e7288af6d88a1f6a930c0fcc4e7a8a9936b34e07629d815d1eab4d977/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d425344253230332d2d436c617573652d626c75652e737667" alt="License" data-canonical-src="https://img.shields.io/badge/License-BSD%203--Clause-blue.svg" style="max-width: 100%;"></a>

Java Transaction Simulator is a load generation tool that provides a way to simulate Transactions using threads. This simulator can generate High CPU, High Memory, and High DiskIO transactions with a user-chosen probability. This simulator is designed to generate datasets to compare the merits of various visualization tools available for exploring Java Flight Recorder (JFR) profiles to diagnose performance issues.

### Usage

#### Clone & build the repository

```sh
$ git clone https://github.com/salesforce-misc/perfGenie.git
$ export JAVA_HOME=<jdk8 home path>
$ mvn clean install
```
#### Run

```sh
$ java -jar simulator/target/simulator-0.0.1-SNAPSHOT.jar

Below configuration options are available on the simulator.

-t,--threads <arg>          Number of simulator thread to spin up (Default: 10)

-b,--txCount <arg>          Number of transactions per thread (Default: 1000)

-d,--maxDepth <arg>         Max depth of the transaction trace (Default: 10)

-c,--highCpuProb <arg>      Probability of high CPU events (Default: 0.05)

-i,--highIoProb <arg>       Probability of high IO events (Default: 0.01)

-m,--highMemoryProb <arg>   Probability of high Memory events (Default:0.01)

Note: Probability values range form (0-1)
```

### Dataset Generation

The simulator generates the following different types of data. Each of these types have their own merits which highlight's different types of performance characteristics of a Java Application.

#### JFR Profiles
A detailed introduction to [Java Flight Recorder (JFR)](https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/about.htm#JFRRT107) is provided in the official documentations. The steps provided below will help with collecting a JFR recoding for this simulator application using [Java Mission Control (JMC)](https://www.oracle.com/java/technologies/jdk-mission-control.html) tool.
1. Download and install the JMC tool for your platform from [JMC Download Website](https://www.oracle.com/java/technologies/javase/products-jmc8-downloads.html)
2. Run the simulator with your preferred options
3. Open the JMC tool start a JFR recording by choosing the simulator application from the JVM browser table as shown in the below image
<img width="814" alt="jmc" src="https://user-images.githubusercontent.com/10486426/206943979-c513ca9a-51a1-4916-aaf7-c6c7055e4474.png">
4. Follow onscreen instructions to complete the JFR recording in JMC tool.

#### JFR Custom Events
By default, below simple custom JFR events are emitted by the Simulator.
- CPUEvent - This event records the CPU load generated by the simulator every minute
- TxCPUEvent - This event records the transaction level CPU consumption

This simulator tool can be extended further to include additional events/fields as required. A simple example would be adding a tenant field into the custom events to simulate a multi tenant application behaviour.

#### JStack Data

The simulator is configured to collect [JStack](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstack.html) samples during its run every minute to provide a snapshot of the threads/transactions running in the simulator. These are collect along with the CPU load to give an approximate estimate of what stack traces are contributing the CPU usage.
